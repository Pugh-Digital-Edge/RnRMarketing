---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import { formatDate } from "@libs/utils.js";
import "@styles/blog.less";

// Get posts from the blog collection and sort by date
const posts = await getCollection("blog");
posts.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());
const recentPosts = posts.slice(0, 3);
---

<section id="blog-1580">
  <div class="cs-container">
      <div class="cs-content">
          <div class="cs-content-flex">
              <span class="cs-topper">Newest Articles</span>
              <h2 class="cs-title">Learn About Key Digital Marketing Concepts</h2>
          </div>
          <a href="/resources" class="cs-button-solid">View All</a>
      </div>
      <ul class="cs-card-group">
        {recentPosts.map((post) => (
            <li class="cs-item">
                <a href={`/resources/${post.slug}`} class="cs-link">
                  <picture class="cs-picture" aria-hidden="true">
                    <source media="(max-width: 600px)" srcset={post.data.image.src}>
                    <source media="(min-width: 601px)" srcset={post.data.image.src}>
                    <img loading="lazy" decoding="async" src={post.data.image.src} alt={post.data.imageAlt} width="413" height="284">
                  </picture>
                  <div class="cs-flex">
                      <span class="cs-date">{formatDate(post.data.date)}</span>
                      <h3 class="cs-h3">{post.data.title}</h3>
                      <p class="cs-item-text">
                        {post.data.description}
                      </p>
                  </div>
                </a>
            </li>
        ))}          
      </ul>
  </div>
</section>
